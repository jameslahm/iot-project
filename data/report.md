## 声波信号模拟蓝牙通信

### 协议设计

- 编码方式：使用6000Hz和10000Hz分别对1和0进行FSK调制，窗口长度为10ms，得到音频信号
- 数据包格式：每个数据包由前导码，数据长度，总帧数以及负载数据组成；前导码为10101010，占一个字节，用于标识数据包起始位置；数据长度代表负载数据的字节数，占一个字节；总帧数代表数据分段后发送的数据包总数目，占用一个字节，用于识别数据分段情况，数据分段大小为255个字节；负载数据即实际要发送的数据



### 功能实现

- [x] 支持传输任意文本数据，包括中英文等
- [x] 支持数据分段发送，分包大小为255个字节



### 实现逻辑

- 发送端：首先得到文本数据的`utf-8`字节编码形式，再对负载数据加上前导码，数据长度以及总帧数信息封装为数据包后，将数据包转为比特序列，再对比特序列使用规定的编码方式进行调制，得到要发送的音频信号，进行发送
- 接收端：实时对接收到的音频信号进行处理，首先将信号置入缓冲区，每次对缓冲区中的信号进行逐段滑动，得到一系列窗口，对该一系列窗口进行傅里叶变换后，可得到前导码首比特的编码频率的幅值序列，若该幅值序列中达到设定好的阈值，则对其进行准确定位到起始窗口位置，并解码后面的比特序列，若为前导码，则根据规定的数据包格式，获取数据长度、总帧数及实际负载数据等



### 性能测量结果

> 由于设置的分段大小为255个字节，而在测试过程中使用20字节长度的数据，因此若出现一个bit错误，则记作该数据包丢失，因此测得的丢包率即该单个数据包是否完全正确

#### 距离对传输性能的影响

数据记录

| 距离(cm) | 误码率%(三次平行试验) |       |       | 平均误码率% | 丢包率% |
| -------: | --------------------: | ----: | ----: | ----------: | ------- |
|       20 |                  0.00 |  0.00 |  0.00 |        0.00 | 0.00    |
|       40 |                  4.37 | 14.37 |  0.00 |        6.24 | 66.67   |
|       60 |                 15.62 | 45.63 | 19.37 |       26.87 | 100.00  |
|       80 |                 20.62 |  6.25 |  0.62 |        9.16 | 100.00  |
|      100 |                 36.87 | 84.37 | 82.50 |       67.91 | 100.00  |

误码率柱状图

![](message_distance_bit.png)

丢包率柱状图

![](message_distance_pkg.png)

可以看到随着距离的提升，误码率和丢包率呈上升趋势，距离越大，信号在信道传输的过程中多径效应越强，衰减越快，对信号解码错误率会更高



#### 抗干扰能力

数据记录

| 噪声强度(dB) | 误码率%(三次平行试验) |      |      | 平均误码率% | 丢包率% |
| -----------: | --------------------: | ---: | ---: | ----------: | ------- |
|           20 |                  3.12 | 1.25 | 0.62 |        1.66 | 100.00  |
|           45 |                  0.00 | 3.12 | 0.62 |        1.25 | 66.67   |
|           60 |                  3.12 | 0.62 | 3.12 |        2.29 | 100.00  |

误码率柱状图

![](message_noise_bit.png)

丢包率柱状图

![](message_noise_pkg.png)

可以看到抗干扰能力较强，噪声强度的增大对传输性能没有很大的影响，主要原因可能是模拟的环境的噪声的频率未对信号传输的频率造成干扰，而不会影响到实际的解码过程



#### 遮挡影响

数据记录

| 遮挡厚度(cm) | 误码率%(三次平行试验) |      |        | 平均误码率% | 丢包率% |
| -----------: | --------------------: | ---: | -----: | ----------: | ------- |
|            1 |                  1.25 |   40 |   8.12 |       16.46 | 100.00  |
|            5 |                100.00 |  100 | 100.00 |      100.00 | 100.00  |
|           10 |                100.00 |  100 | 100.00 |      100.00 | 100.00  |
|           20 |                100.00 |  100 | 100.00 |      100.00 | 100.00  |

误码率柱状图

![](message_occlude_bit.png)

丢包率柱状图

![](message_occlude_pkg.png)

在实际实验过程中，发现当遮挡厚度达到5cm后，数据长度及总帧数在传输过程中会出现解码错误，从而造成负载数据的解码出现错误，得不到实际的完整负载数据，导致后面的误码率计算得到均为100%，主要原因可能是随着遮挡厚度变大，信号在传输过程中的衰减越大，因反射造成的多径效应越强，从而导致经过信道传输后的数据误码率较高



#### 解码算法性能

对提供的音频进行解码，得到

